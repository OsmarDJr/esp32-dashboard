<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gráfico ESP32</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Gráfico de Temperatura e Umidade</h2>
  <canvas id="grafico" width="800" height="400"></canvas>

  <script>
    function callback(data) {
      const labels = data.map(item => new Date(item.data).toLocaleString());
      const temp = data.map(item => item.temperatura);
      const umid = data.map(item => item.umidade);

      new Chart(document.getElementById('grafico'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: "Temperatura (°C)",
              data: temp,
              borderColor: "red",
              fill: false
            },
            {
              label: "Umidade (%)",
              data: umid,
              borderColor: "blue",
              fill: false
            }
          ]
        }
      });
    }

    // IMPORTANTE: JSONP via script
    const url = "https://script.google.com/macros/s/AKfycbxqErOsNo88wOoRy4oYTsvpEN3wfwi3VqpI6-VQBbFD4lmxlYyEQ2UWjoo9EY4bjfGNww/exec?callback=callback";
    const script = document.createElement('script');
    script.src = url;
    document.body.appendChild(script);
  </script>
</body>
</html>
